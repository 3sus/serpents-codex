<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Serpent’s Codex</title>
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
<style>
@font-face {
  font-family: 'MagicSchool';
  src: local('MagicSchool'), url('MagicSchool.woff2') format('woff2');
  font-weight: normal;
  font-style: normal;
}
:root {
  --slytherin-background: #0a2414;
  --slytherin-card-bg: #e8ecef;
  --slytherin-text: #000000;
  --slytherin-header: #cccccc;
  --slytherin-accent: #1a3c34;
  --slytherin-border: #4a7043;
}
body {
  background: var(--slytherin-background);
  color: var(--slytherin-text);
  font-family: 'Roboto', sans-serif;
  max-width: 800px;
  margin: 20px auto;
  padding: 8px;
  position: relative;
  overflow-x: hidden;
}
@media (max-width: 600px) {
  body { padding: 8px; }
  .title { font-size: 2.8em; }
}
#loadingSpinner {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 40px;
  height: 40px;
  border: 4px solid var(--slytherin-border);
  border-top: 4px solid transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  z-index: 20;
  display: none;
}
@keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
}
header { text-align: center; margin-bottom: 20px; }
.title {
  display: inline-block;
  font-family: 'MagicSchool', 'Roboto', sans-serif;
  color: var(--slytherin-header);
  font-size: 3.5em;
  font-weight: 300;
  text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.2);
  letter-spacing: 0.05em;
  line-height: 1.2;
}
.title span {
  opacity: 0;
  animation: appear 0.12s forwards;
}
.title span:nth-child(1) { animation-delay: 0.12s; }
.title span:nth-child(2) { animation-delay: 0.24s; }
.title span:nth-child(3) { animation-delay: 0.36s; }
.title span:nth-child(4) { animation-delay: 0.48s; }
.title span:nth-child(5) { animation-delay: 0.60s; }
.title span:nth-child(6) { animation-delay: 0.72s; }
.title span:nth-child(7) { animation-delay: 0.84s; }
.title span:nth-child(8) { animation-delay: 0.96s; }
.title span:nth-child(9) { animation-delay: 1.08s; }
.title span:nth-child(10) { animation-delay: 1.20s; }
.title span:nth-child(11) { animation-delay: 1.32s; }
.title span:nth-child(12) { animation-delay: 1.44s; }
.title span:nth-child(13) { animation-delay: 1.56s; }
.title span:nth-child(14) { animation-delay: 1.68s; }
.title span:nth-child(15) { animation-delay: 1.80s; }
@keyframes appear { to { opacity: 1; } }
.made-by {
  font-size: 0.8em;
  font-style: italic;
  color: var(--slytherin-header);
  text-align: center;
  margin-top: -10px;
}
.storage-warning {
  background: var(--slytherin-accent);
  color: var(--slytherin-header);
  padding: 8px;
  border-radius: 5px;
  margin-bottom: 16px;
  font-size: 0.9em;
  text-align: center;
  display: none;
}
.storage-warning button {
  background: var(--slytherin-accent);
  color: var(--slytherin-card-bg);
  border: none;
  padding: 5px 10px;
  border-radius: 6px;
  cursor: pointer;
  margin-left: 8px;
  transition: all 0.3s ease;
}
.storage-warning button:hover {
  background: var(--slytherin-border);
  box-shadow: 0 0 10px var(--slytherin-border);
  transform: scale(1.05);
}
#searchBar {
  width: 100%;
  padding: 8px;
  margin-bottom: 16px;
  font-size: 1em;
  border: 1px solid var(--slytherin-border);
  border-radius: 8px;
  background: var(--slytherin-card-bg);
  color: var(--slytherin-text);
  position: sticky;
  top: 0;
  z-index: 5;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: box-shadow 0.3s ease;
}
#searchBar:hover, #searchBar:focus {
  box-shadow: 0 0 10px var(--slytherin-border);
}
.search-suggestions {
  position: absolute;
  width: 100%;
  max-height: 150px;
  overflow-y: auto;
  background: var(--slytherin-card-bg);
  border: 1px solid var(--slytherin-border);
  border-radius: 5px;
  z-index: 6;
  display: none;
  animation: fadeInSuggestions 0.3s ease;
}
@keyframes fadeInSuggestions { from { opacity: 0; } to { opacity: 1; } }
.search-suggestions div {
  padding: 8px 10px;
  cursor: pointer;
  color: var(--slytherin-text);
  font-size: 1.1em;
}
.search-suggestions div:hover {
  background: var(--slytherin-border);
  color: var(--slytherin-header);
}
details {
  margin: 8px 0;
  background: var(--slytherin-card-bg);
  padding: 8px;
  border-radius: 6px;
  border: 1px solid var(--slytherin-border);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
details:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}
summary {
  cursor: pointer;
  font-weight: 700;
  font-size: 1.3em;
  color: var(--slytherin-header);
  padding: 5px;
  background: var(--slytherin-accent);
  border-radius: 5px;
  transition: box-shadow 0.3s ease;
}
summary:hover {
  box-shadow: 0 0 6px var(--slytherin-border);
}
ul { list-style-type: none; padding-left: 16px; }
li { margin: 5px 0; font-size: 1em; line-height: 1.5; color: var(--slytherin-text); }
.notes {
  font-style: italic;
  color: var(--slytherin-accent);
  margin: 5px 0;
  font-size: 0.9em;
}
.checklist-item {
  display: flex;
  align-items: center;
  margin: 5px 0;
}
.checklist-item input { margin-right: 8px; }
.checklist-item span { color: var(--slytherin-text); font-size: 1em; }
.timer {
  margin-left: 8px;
  font-size: 0.9em;
  color: var(--slytherin-border);
  background: #ffffff;
  padding: 2px 6px;
  border-radius: 3px;
  display: inline-block;
  min-width: 80px;
}
.guide-button {
  display: inline-block;
  padding: 5px 10px;
  background: var(--slytherin-accent);
  color: var(--slytherin-card-bg);
  text-decoration: none;
  border-radius: 6px;
  margin: 5px 0;
  font-size: 0.9em;
  transition: all 0.3s ease;
}
.guide-button:hover {
  background: var(--slytherin-border);
  box-shadow: 0 0 10px var(--slytherin-border);
  transform: scale(1.05);
}
.highlight {
  background-color: #ffff99;
}
</style>
</head>
<body>
<div id="loadingSpinner"></div>
<canvas id="particles"></canvas>
<header>
<h1 class="title"><span>S</span><span>e</span><span>r</span><span>p</span><span>e</span><span>n</span><span>t</span><span>’</span><span>s</span><span> </span><span>C</span><span>o</span><span>d</span><span>e</span><span>x</span></h1>
</header>
<p class="made-by">Made by Yogtze</p>
<div id="storageWarning" class="storage-warning">Local storage is disabled. Timers will reset when you close the page. Try disabling incognito mode or enabling storage. <button onclick="this.parentNode.style.display='none'">Dismiss</button><button onclick="downloadProgress()">Download Progress</button><input type="file" id="uploadProgress" style="display:none" accept=".json"><button onclick="document.getElementById('uploadProgress').click()">Upload Progress</button></div>
<input type="text" id="searchBar" placeholder="Search for a subject, daily, or guide..." onkeyup="searchContent()" aria-label="Search content">
<div class="search-suggestions" id="suggestions"></div>
<details id="year1"><summary>Class Answers</summary>
<details><summary>Potions</summary><ul>
<li><strong>Symbolism:</strong> Rebirth, Felix Fortuity, Hope</li>
<li><strong>Ice Potion:</strong> Black, Most, Fiendfyre, Ice</li>
<li><strong>Confusion Concoction:</strong> Vitamin C, Confusing Draught, Scurvy Grass</li>
<li><strong>Amnesia:</strong> True, Red, Weeks, Lethe</li>
<li><strong>Sleeping Draught:</strong> True, Medieval times, 19th century</li>
<li><strong>Insomnia:</strong> 48 hours, True, Snake</li>
<li><strong>Cucurbita:</strong> Orange, False, Encases the drinker's head into a pumpkin</li>
<li><strong>Herbicide:</strong> Thickens them, It can kill weeds, False</li>
<li><strong>Remedy for Regular Toxins:</strong> Bezoar, Powdered, Bowtruckle, Uncommon</li>
</ul></details>
<details><summary>Magical History</summary><ul>
<li><strong>St Mungos:</strong> 15 years, Private, 1612</li>
<li><strong>Salazar Serpent:</strong> False, Parseltongue, a Basilisk</li>
<li><strong>Godric Lion:</strong> Salazar Serpents, Ragnuk the First, Godric's Hollow</li>
<li><strong>Helga Badger:</strong> House-elves, Enchantments, Honesty</li>
<li><strong>Rowena Ravens:</strong> Albania, Helga Badgers, The grand staircase</li>
<li><strong>Werewolf Code of Conduct:</strong> Name, Lycanthropy, 2011</li>
<li><strong>International Statute of Secrecy:</strong> Gavroche Grelenwaffe & Lord Voldemort, Henry Parker, International Statute of Secrecy</li>
<li><strong>Greedgotts:</strong> 10 years, 1865, 1474, Quirinus Quarrel, Dragon</li>
</ul></details>
<details><summary>Enchantments</summary><ul>
<li><strong>Fixo:</strong> Coloseum in Rome, 1754, Wand</li>
<li><strong>Basics of Enchantments:</strong> They could backfire, Enchantments alter the properties, Dancing</li>
<li><strong>Finite incantatem:</strong> fi-NEE-tay in-can-TAH-tem, General counter spell, Red</li>
<li><strong>Diffindo:</strong> Swish, Wart, Fifteenth</li>
<li><strong>Periculum Incantatem:</strong> Explosion, Red, Periculum</li>
<li><strong>Engorgement:</strong> Icy Blue, Reducio, Explosions</li>
<li><strong>Alohomora:</strong> Eldon Elsrickle, You didn't tell us, Red</li>
<li><strong>Refilling:</strong> Replenish, Green, Filling motion</li>
<li><strong>Petrificus Totalus:</strong> Ehpeepeekey, Body Freezing Spell, Curse</li>
</ul></details>
<details><summary>Transfiguration</summary><ul>
<li><strong>Aguamenti:</strong> Light blue, True, Incendio</li>
<li><strong>Animagi:</strong> Guardian, Markings, Amino</li>
<li><strong>Flintifors:</strong> Weaker, Dew Dew, Wrong emphasis in the incantation</li>
<li><strong>Reparifarge:</strong> Age, White, Partially transformed target</li>
<li><strong>Vera Verto:</strong> Green, Three, Transformations</li>
<li><strong>Avifors:</strong> Avis, Eggs, Transformations</li>
<li><strong>Rabbits to Slippers:</strong> Lapifors, Cows, Transformation</li>
</ul></details>
<details><summary>Dark Arts Defense</summary><ul>
<li><strong>Imps:</strong> Britain and Ireland, Grey, Knockback Jinx</li>
<li><strong>Ghouls:</strong> Ghoul Task Force, Bugs, Wails</li>
<li><strong>Werewolves:</strong> Apply Dittany and Silver, Lycanthropy, Aconite Potion</li>
<li><strong>Hags:</strong> 4, Honoria Nutcombe, Rudimentray, Children</li>
<li><strong>Revulsion Jinx:</strong> ruh-LASH-ee-oh, Bukavac, Incarceration spells</li>
<li><strong>Tarantallagra:</strong> True, RON & LEG, Protego</li>
<li><strong>Trolls:</strong> XXXX, Stunning Spell, Oceanic</li>
<li><strong>Types of Dark Charms:</strong> Eye contant with the victim, Jinxes, Life</li>
<li><strong>Vampires:</strong> Saliva, Garlic, Being</li>
<li><strong>Bukavac:</strong> Revulsion Jinx, Break their grip, XX</li>
<li><strong>Poxies:</strong> Knockback Jinx, Their numbers might overwhelm you, Arms and legs</li>
<li><strong>Pixies:</strong> Eradicating the species, 0, Eight</li>
</ul></details>
<details><summary>Astronomy</summary><ul>
<li><strong>Mercury:</strong> 36 million miles, God of messengers, 88</li>
<li><strong>Jupiter:</strong> False, One of four, The Romanian King of Gods</li>
<li><strong>Asteroids:</strong> Star-like, Dactyl, Mars and Jupiter</li>
<li><strong>Saturn:</strong> God of Time, Galileo Galilei, Brown eyes</li>
<li><strong>Introduction to Astronomy:</strong> Fluxweed, The study of celestial objects, Manipulating tools and improving the accuracy of measurements</li>
<li><strong>Telescopes:</strong> Break-Resistant, A solar eclipse, Aperture</li>
<li><strong>Uranus:</strong> Ice Giant, 84 years, Characters from 'Midsummer Night's Dream and a poem from Alexander Pope</li>
</ul></details>
<details><summary>Herbology</summary><ul>
<li><strong>Womandrake:</strong> 1912, Dragon-Hide Gloves, Mature</li>
<li><strong>Lavender:</strong> Calming sleep aid stress, Flowers, Purple</li>
<li><strong>Devils Snare:</strong> Flipefy, Flitterbloom, Dark and damp</li>
<li><strong>Knotgrass:</strong> Versispellis potion, Six feet, White</li>
<li><strong>Spiky Bush:</strong> 30, South America, Incendio</li>
<li><strong>Moly:</strong> The Odyssey, Black and White, Flat, grassy areas</li>
</ul></details>
<details><summary>Gummle Studies</summary><ul>
<li><strong>Gummle Films:</strong> Nachos, Projector, Stunt Double</li>
</ul></details>
</details>
<details id="dailies"><summary>Dailies</summary><ul>
<li class="checklist-item"><input type="checkbox" id="daily1" aria-label="Enchantments, Transfiguration, and Dark Arts Defense" aria-describedby="timer1"><span><strong>Enchantments, Transfiguration, and Dark Arts Defense</strong> spell casts</span><span class="timer" id="timer1"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily2" aria-label="Hagberts Mine pt1" aria-describedby="timer2"><span><strong>Hagberts Mine pt1</strong> <em>*all at one*</em></span><span class="timer" id="timer2"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily7" aria-label="Hagberts Mine pt2" aria-describedby="timer7"><span><strong>Hagberts Mine pt2</strong> <em>*if super bored, all at once again*</em></span><span class="timer" id="timer7"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily3" aria-label="Room of Mysteries Maze" aria-describedby="timer3"><span><strong>Room of Mysteries Maze</strong> <em>*follow hay bales*</em></span><span class="timer" id="timer3"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily8" aria-label="Hagberts Hut gift" aria-describedby="timer8"><span><strong>Hagberts Hut gift</strong></span><span class="timer" id="timer8"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily4" aria-label="Warlocks Stone pt5" aria-describedby="timer4"><span><strong>Warlocks Stone pt5</strong></span><span class="timer" id="timer4"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily5" aria-label="Springs Magical Oak Tree Farm pt1-3" aria-describedby="timer5"><span><strong>Springs Magical Oak Tree Farm pt1-3</strong> <em>*you'll need to repair once at Hagberts Mine*</em></span><span class="timer" id="timer5"></span></li>
<li class="checklist-item"><input type="checkbox" id="daily6" aria-label="Evie's Google Doc Speedrun" aria-describedby="timer6"><span><a href="https://docs.google.com/document/d/1KlI0sTRkMXmw8MS5kB4-ZhlUem7U_gWqrfNOvcXdPQg/edit?tab=t.6x2tieuubr07" class="guide-button" target="_blank" rel="noopener">Evie's Google Doc Speedrun</a></span><span class="timer" id="timer6"></span></li>
</ul></details>
<details id="buyIngredients"><summary>Where to Buy Ingredients</summary>
<details><summary>Pete's Pewter Pots</summary><ul>
<li><strong>Location:</strong> [-1106 19 157]</li>
<li>Bursting Mushroom 10g</li>
<li>Knotgrass 6g</li>
<li>Scurvy Grass 20g</li>
<li>Womandrake 25g</li>
<li>Ginger Root 9g</li>
<li>Standard Ingredient 3g</li>
<li>Willywig Sting 5g</li>
</ul></details>
<details><summary>Beck and Apothecary</summary><ul>
<li><strong>Location:</strong> [-1123 19 162]</li>
<li>Unicorn Horn 15g</li>
<li>Rat Spleen 12g</li>
<li>Lorkhump 6g</li>
<li>Tricorn Horn 20g</li>
<li>Choorang 19g</li>
<li>Dragon Scale 10g</li>
<li>Lethe River Water 5g</li>
<li>Griffin Claw 8g</li>
</ul></details>
<details><summary>G. Peppin's Potions</summary><ul>
<li><strong>Location:</strong> [-1164 19 307]</li>
<li>Salamander Blood 6g</li>
<li>Snake Fang 4g</li>
<li>Poxy Eggs 20g</li>
<li>Flying Seahorses 18g</li>
<li>Bezoar 5g</li>
<li>Leeches 7g</li>
<li>Lacewing Flies 10g</li>
<li>Slobberworm 20g</li>
</ul></details>
<details><summary>Hogrin and Durms</summary><ul>
<li><strong>Location:</strong> [-1205 14 364]</li>
<li>Tentalap Tentacles 18g</li>
<li>Dragonfly Thoraxes 10g</li>
<li>Wartcap 6g</li>
<li>Porcupine Quill 8g</li>
<li>Eel Eye 16g</li>
<li>Octopus 7g</li>
<li>Lionfish Spine 5g</li>
<li>Armadillo Liver 7g</li>
<li>Pickled Tentalap Tentacles 38g</li>
</ul></details>
<details><summary>Deep Knockturn Shopkeeper</summary><ul>
<li><strong>Location:</strong> [-1193 11 407]</li>
<li>Dragon Blood 14g</li>
<li>Leeches 6g</li>
<li>Rat Spleen 5g</li>
<li>Unicorn Horn 14g</li>
<li>Eel Eye 5g</li>
<li>Bursting Mushroom 12g</li>
</ul></details>
<details><summary>The Clever Cover</summary><ul>
<li><strong>Location:</strong> [-1155 23 376]</li>
<li>Tricorn Horn 20g</li>
<li>Fluxweed 15g</li>
<li>Beetle 17g</li>
</ul></details>
<details><summary>Nev behind Greenhouses</summary><ul>
<li><strong>Location:</strong> [-8931 43 9323]</li>
<li>Lavender 12g</li>
<li>Valerian 17g</li>
<li>Dried Nettle 6g</li>
<li>Mistletoe Berry 4g</li>
<li>Pumpkin 7g</li>
<li>Wolfsbane 8g</li>
<li>Fireseed 4g</li>
</ul></details>
</details>
<details id="findIngredients"><summary>Where to Find Ingredients</summary><ul>
<li><strong>Bezoar:</strong> On top of the Owlery [-9479 152 8869]</li>
<li><strong>Lethe River Water:</strong> Far left corner of Whispering Woods [-9988 30 8340]</li>
<li><strong>Salamander Blood:</strong> Far left corner of Kitchens [-9827 31 9277]</li>
<li><strong>Phoenix Tail Feather:</strong> Dumblestorm's Tomb [-10087 16 9561]</li>
<li><strong>Armadillo Liver:</strong> Serpent Secret Room [-9412 28 9438]</li>
<li><strong>Griffin Claw:</strong> Opposite Boathouse [-10187 28 9427]</li>
<li><strong>Ginger Root:</strong> Bashing Birch Tree [-9749 30 8870]</li>
<li><strong>Dragon Scale:</strong> Middle left of Whispering Woods [-9930 33 8592]</li>
<li><strong>Unicorn Horn:</strong> Middle of Whispering Woods [-9820 6 8603]</li>
<li><strong>Lacewing Flies:</strong> Detention Room [-9727 39 9207]</li>
<li><strong>Porcupine Quills:</strong> Transfiguration Classroom [-9211 40 9449]</li>
<li><strong>Mushrooms, Critters, Plants:</strong> All types of shrooms, Boomslang, Flobberworms, Beetles can be found on the ground in the Whispering Woods</li>
<li><strong>Fish-related Ingredients:</strong> All ingredients with the word "fish" can be found with a rod in open waters</li>
</ul></details>
<details id="potionNeeds"><summary>Potion Needs</summary>
<details><summary>Year 1</summary>
<details><summary>Cucurbita Potion</summary><ul>
<li>2 Pumpkins (whole)</li>
<li>3 Fire Seeds (whole)</li>
<li>1 Griffin Claw (crushed)</li>
<li><a href="https://i.ibb.co/prPNqtd/5book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 55g each</li>
</ul></details>
<details><summary>Remedy for Regular Toxins</summary><ul>
<li>4 Bezoar (crushed)</li>
<li>2 Standard Ingredient (whole)</li>
<li>1 Unicorn Horn (powdered)</li>
<li>2 Mistletoe Berries (whole)</li>
<li><a href="https://i.ibb.co/ysKRxCn/1book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 60g each</li>
</ul></details>
<details><summary>Cleanse for Blisters</summary><ul>
<li>6 Snake Fang (powdered)</li>
<li>4 Slobberworm (whole)</li>
<li>2 Porcupine Quill (whole)</li>
<li><a href="https://i.ibb.co/jh4pMc1/3book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 130g each</li>
</ul></details>
<details><summary>Fire Protection Potion</summary><ul>
<li>2 Bursting Mushrooms (sliced)</li>
<li>1 Salamander Blood (whole)</li>
<li>5 Wartcap (powdered)</li>
<li><a href="https://i.ibb.co/B4DbCVp/2book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 65g each</li>
</ul></details>
<details><summary>Amnesia Potion</summary><ul>
<li>2 Lethe River Water (whole)</li>
<li>2 Standard Ingredient (whole)</li>
<li>16 Mistletoe Berries (powdered)</li>
<li><a href="https://i.ibb.co/fX0Vyzx/4book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 70g each</li>
</ul></details>
<details><summary>Insomnia Potion</summary><ul>
<li>6 Billywig Stings (whole)</li>
<li>7 Snake Fang (crushed)</li>
<li>4 Standard Ingredient (powdered)</li>
<li>2 Wolfsbane (crushed)</li>
<li><a href="https://i.ibb.co/zbKcSDw/6book0.png" class="guide-button" target="_blank" rel="noopener">View Recipe</a></li>
<li>Sells for 85g each</li>
</ul></details>
</details>
<details><summary>Year 2</summary><p>Not unlocked yet</p></details>
<details><summary>Year 3</summary><p>Not unlocked yet</p></details>
<details><summary>Year 4</summary><p>Not unlocked yet</p></details>
<details><summary>Year 5</summary><p>Not unlocked yet</p></details>
<details><summary>Year 6</summary><p>Not unlocked yet</p></details>
<details><summary>Year 7</summary><p>Not unlocked yet</p></details>
<details><summary>Graduate</summary><p>Not unlocked yet</p></details>
</details>
<details id="moreGuides"><summary>More Detailed Guides</summary><ul>
<li><a href="Roxas Potions.pdf" class="guide-button" target="_blank" rel="noopener">Roxas’ Comprehensive Guide to Potions</a></li>
<li><a href="Roxas Stormcrest.pdf" class="guide-button" target="_blank" rel="noopener">Roxas’ Comprehensive Beginner’s Guide to Stormcrest</a></li>
</ul></details>
<script>
const magicSchoolFont = new FontFace('MagicSchool', 'url(MagicSchool.woff2)');
magicSchoolFont.load();
const loadingSpinner = document.getElementById('loadingSpinner');
window.addEventListener('load', () => {
  loadingSpinner.style.display = 'none';
});
const canvas = document.getElementById('particles');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
const particles = [];
for (let i = 0; i < 50; i++) {
  particles.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    radius: Math.random() * 2 + 1,
    type: Math.random() > 0.5 ? 'star' : 'bubble',
    vx: Math.random() * 0.6 - 0.3,
    vy: Math.random() * 0.6 - 0.3,
    opacity: Math.random() * 0.1 + 0.15
  });
}
function animateParticles() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  particles.forEach(p => {
    ctx.fillStyle = `rgba(204, 204, 204, ${p.opacity})`;
    ctx.beginPath();
    if (p.type === 'star') {
      ctx.moveTo(p.x, p.y - p.radius);
      ctx.lineTo(p.x + p.radius * 0.3, p.y + p.radius * 0.3);
      ctx.lineTo(p.x + p.radius, p.y + p.radius);
      ctx.lineTo(p.x + p.radius * 0.3, p.y + p.radius * 0.3);
      ctx.lineTo(p.x, p.y + p.radius * 2);
      ctx.lineTo(p.x - p.radius * 0.3, p.y + p.radius * 0.3);
      ctx.lineTo(p.x - p.radius, p.y + p.radius);
      ctx.lineTo(p.x - p.radius * 0.3, p.y + p.radius * 0.3);
      ctx.lineTo(p.x, p.y - p.radius);
    } else {
      ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    }
    ctx.fill();
    p.x += p.vx;
    p.y += p.vy;
    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
  });
  requestAnimationFrame(animateParticles);
}
animateParticles();
let timerStore = {};
let useLocalStorage = true;
let originalContent = {};
document.addEventListener('DOMContentLoaded', () => {
  loadingSpinner.style.display = 'block';
  try {
    localStorage.setItem('test', 'test');
    localStorage.removeItem('test');
  } catch (e) {
    useLocalStorage = false;
    document.getElementById('storageWarning').style.display = 'block';
    console.warn('localStorage unavailable, using timerStore:', e.message);
  }
  document.querySelectorAll('.checklist-item input').forEach(t => {
    try {
      const checked = useLocalStorage ? localStorage.getItem(t.id) === 'true' : (timerStore[t.id] === true);
      t.checked = checked || false;
      t.addEventListener('change', () => {
        try {
          if (useLocalStorage) {
            localStorage.setItem(t.id, t.checked);
            localStorage.setItem(`${t.id}_time`, t.checked ? Date.now().toString() : '');
          } else {
            timerStore[t.id] = t.checked;
            timerStore[`${t.id}_time`] = t.checked ? Date.now().toString() : '';
          }
          updateTimers();
        } catch (e) {
          console.error('Error saving timer state:', e.message);
          document.getElementById('storageWarning').style.display = 'block';
          document.getElementById('storageWarning').textContent = 'Error saving progress. Please try again or download progress.';
        }
      });
    } catch (e) {
      console.error('Error initializing checkbox:', e.message);
    }
  });
  document.querySelectorAll('details li:not(:has(a.guide-button)), details summary').forEach(el => {
    originalContent[el.textContent] = el.innerHTML;
  });
  const searchBar = document.getElementById('searchBar');
  const suggestions = document.getElementById('suggestions');
  const allTopics = Array.from(document.querySelectorAll('#year1 li, #buyIngredients li, #findIngredients li, #potionNeeds summary, #moreGuides li')).map(el => {
    const strong = el.querySelector('strong');
    const a = el.querySelector('a');
    return strong ? strong.textContent : a ? a.textContent : el.textContent.split(':')[0].trim();
  }).filter(t => t);
  searchBar.addEventListener('input', () => {
    const query = searchBar.value.toLowerCase();
    suggestions.innerHTML = '';
    if (query) {
      const matches = allTopics.filter(t => t.toLowerCase().includes(query));
      matches.forEach(m => {
        const div = document.createElement('div');
        div.textContent = m;
        div.addEventListener('click', () => {
          searchBar.value = m;
          searchContent();
          suggestions.style.display = 'none';
        });
        suggestions.appendChild(div);
      });
      suggestions.style.display = matches.length ? 'block' : 'none';
    } else {
      suggestions.style.display = 'none';
    }
    searchContent();
  });
  const details = document.querySelectorAll('details');
  details.forEach((d, i) => {
    d.setAttribute('tabindex', '0');
    d.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        d.open = !d.open;
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (i < details.length - 1) details[i + 1].focus();
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (i > 0) details[i - 1].focus();
      }
    });
  });
  window.downloadProgress = () => {
    try {
      const data = useLocalStorage ? { ...localStorage } : { ...timerStore };
      const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'serpents-codex-progress.json';
      a.click();
      URL.revokeObjectURL(url);
    } catch (e) {
      console.error('Error downloading progress:', e.message);
      document.getElementById('storageWarning').style.display = 'block';
      document.getElementById('storageWarning').textContent = 'Error downloading progress. Please try again.';
    }
  };
  document.getElementById('uploadProgress').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (event) => {
        try {
          const data = JSON.parse(event.target.result);
          if (useLocalStorage) {
            Object.keys(data).forEach(k => localStorage.setItem(k, data[k]));
          } else {
            timerStore = { ...timerStore, ...data };
          }
          location.reload();
        } catch (err) {
          console.error('Failed to load progress:', err.message);
          document.getElementById('storageWarning').style.display = 'block';
          document.getElementById('storageWarning').textContent = 'Failed to load progress. Please try a valid JSON file.';
        }
      };
      reader.readAsText(file);
    }
  });
  updateTimers();
  setInterval(updateTimers, 10000);
});
function updateTimers() {
  try {
    const now = Date.now();
    const checkboxes = document.querySelectorAll('.checklist-item input');
    if (!checkboxes.length) {
      console.warn('No checklist items found');
      return;
    }
    checkboxes.forEach(e => {
      const timerEl = document.getElementById(`timer${e.id.replace('daily', '')}`);
      if (!timerEl) {
        console.warn(`Timer element not found for ${e.id}`);
        return;
      }
      let startTime;
      try {
        startTime = parseInt(useLocalStorage ? localStorage.getItem(`${e.id}_time`) : timerStore[`${e.id}_time`] || '0', 10);
      } catch (err) {
        console.warn(`Error parsing start time for ${e.id}:`, err.message);
        startTime = 0;
      }
      const duration = (e.id === 'daily3' || e.id === 'daily8') ? 86400000 : 64800000;
      if (e.checked && startTime) {
        const timeLeft = startTime + duration - now;
        if (timeLeft > 0) {
          const hours = Math.floor(timeLeft / 3600000);
          const minutes = Math.floor((timeLeft % 3600000) / 60000);
          timerEl.textContent = `${hours}h ${minutes}m left`;
        } else {
          timerEl.textContent = 'Ready!';
          e.checked = false;
          try {
            if (useLocalStorage) {
              localStorage.setItem(e.id, 'false');
              localStorage.removeItem(`${e.id}_time`);
            } else {
              timerStore[e.id] = false;
              delete timerStore[`${e.id}_time`];
            }
          } catch (err) {
            console.error(`Error resetting timer for ${e.id}:`, err.message);
          }
        }
      } else {
        timerEl.textContent = '';
      }
    });
  } catch (t) {
    console.error('Error in updateTimers:', t.message);
    document.getElementById('storageWarning').style.display = 'block';
    document.getElementById('storageWarning').textContent = 'Error updating timers. Please try again or download progress.';
  }
}
function searchContent() {
  try {
    const query = document.getElementById('searchBar').value.toLowerCase();
    document.querySelectorAll('details li:not(:has(a.guide-button)), details summary').forEach(el => {
      el.innerHTML = originalContent[el.textContent] || el.innerHTML;
      if (query) {
        const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, null);
        let node;
        while (node = walker.nextNode()) {
          const parent = node.parentNode;
          if (parent.tagName !== 'A' && parent.className !== 'guide-button') {
            const text = node.textContent;
            if (text.toLowerCase().includes(query)) {
              const newHTML = text.replace(regex, '<span class="highlight">$1</span>');
              const span = document.createElement('span');
              span.innerHTML = newHTML;
              node.replaceWith(...span.childNodes);
            }
          }
        }
      }
    });
    document.querySelectorAll('details').forEach(e => {
      const matches = e.textContent.toLowerCase().includes(query);
      e.style.display = matches ? '' : 'none';
      if (query && matches) {
        const parent = e.closest('details');
        if (parent) parent.open = true;
        e.open = true;
      }
    });
  } catch (t) {
    console.error('Error searching content:', t.message);
    document.getElementById('storageWarning').style.display = 'block';
    document.getElementById('storageWarning').textContent = 'Error searching content. Please try again.';
  }
}
</script>
</body>
</html>
